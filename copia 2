const int pingPin = 9;  // Pino SIG do Parallax Ping
const int ledPin = 3;

const float US_TO_CM = 29.0;  // 29 µs/cm (ida e volta)

void setup() {
  Serial.begin(9600);
  pinMode(pingPin, OUTPUT);
  pinMode(ledPin, OUTPUT);

  digitalWrite(ledPin, LOW);

  Serial.println("=== DETECTOR DE NUVENS ALTAS (> 3 METROS) ===");
  Serial.println("LED acende se nuvem estiver ACIMA de 3m");
  delay(1000);
}

void loop() {
  // --- DISPARO DO PULSO ---
  digitalWrite(pingPin, LOW);
  delayMicroseconds(2);
  digitalWrite(pingPin, HIGH);
  delayMicroseconds(5);
  digitalWrite(pingPin, LOW);

  pinMode(pingPin, INPUT);
  long duration = pulseIn(pingPin, HIGH, 35000);  // Timeout ~6m

  if (duration == 0) {
    Serial.println("Sem reflexo (muito longe ou ceu limpo)");
    digitalWrite(ledPin, LOW);
  } else {
    float distancia_cm = duration / US_TO_CM;
    float distancia_m = distancia_cm / 100.0;

    Serial.print("Altura da nuvem: ");
    Serial.print(distancia_m, 2);
    Serial.println(" m");

    // LED ACENDE SÓ SE A NUVEM ESTIVER MAIOR QUE 3 METROS
    if (distancia_m > 3.0) {
      digitalWrite(ledPin, HIGH);
      Serial.println(">>> NUVEM ALTA DETECTADA! (acima de 3m) <<<");
    } else {
      digitalWrite(ledPin, LOW);
      Serial.println("Nuvem baixa ou sem nuvem alta");
    }
  }

  delay(600);
}
